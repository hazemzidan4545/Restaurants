{% extends "base.html" %}

{% block title %}Edit Menu Item - Admin Dashboard{% endblock %}
{% block page_title %}Edit Menu Item{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="admin-card mb-4">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h2 class="card-title">
                <i class="fas fa-edit"></i>
                Edit Menu Item
            </h2>
            <a href="{{ url_for('admin.menu_management') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Menu
            </a>
        </div>
    </div>
</div>

<!-- Form Section -->
<div class="row justify-content-center">
    <div class="col-md-12 col-lg-10">
        <div class="admin-card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-utensils"></i>
                    Edit Menu Item: {{ menu_item.name }}
                </h3>
                <div class="form-progress">
                    <div class="progress-bar" id="formProgress"></div>
                </div>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data" id="editMenuItemForm" novalidate>
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                    <!-- Basic Information Section -->
                    <div class="form-section mb-4">
                        <h4 class="section-title">
                            <i class="fas fa-info-circle"></i>
                            Basic Information
                        </h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="name" class="form-label">
                                        <i class="fas fa-tag me-1"></i>Item Name <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="name" name="name" required
                                           value="{{ menu_item.name }}" placeholder="e.g., Grilled Chicken, Fresh Orange Juice"
                                           data-validation="required|min:2|max:100">
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Enter a descriptive name for your menu item</div>
                                </div>

                                <div class="mb-3">
                                    <label for="category_id" class="form-label">
                                        <i class="fas fa-folder me-1"></i>Category <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <select class="form-select" id="category_id" name="category_id" required
                                                data-validation="required">
                                            <option value="">Select a category</option>
                                            {% for category in categories %}
                                            <option value="{{ category.category_id }}"
                                                    {% if category.category_id == menu_item.category_id %}selected{% endif %}>
                                                {{ category.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <button type="button" class="btn btn-outline-secondary" id="addCategoryBtn"
                                                title="Add New Category">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Choose the appropriate category for this item</div>
                                </div>

                                <div class="mb-3">
                                    <label for="price" class="form-label">
                                        <i class="fas fa-dollar-sign me-1"></i>Price (EGP) <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">EGP</span>
                                        <input type="number" class="form-control" id="price" name="price"
                                               step="0.01" min="0.01" required value="{{ menu_item.price }}" placeholder="0.00"
                                               data-validation="required|min:0.01|max:9999.99">
                                        <button type="button" class="btn btn-outline-info" id="priceCalculator"
                                                title="Price Calculator">
                                            <i class="fas fa-calculator"></i>
                                        </button>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Set the selling price for this item</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="stock" class="form-label">
                                        <i class="fas fa-boxes me-1"></i>Stock Quantity
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="stock" name="stock"
                                               min="0" value="{{ menu_item.stock }}" placeholder="0"
                                               data-validation="min:0|max:99999">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="checkbox" id="unlimitedStock"
                                                   {% if menu_item.stock == 0 %}checked{% endif %}>
                                            <label class="form-check-label ms-1" for="unlimitedStock">Unlimited</label>
                                        </div>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Current stock quantity (0 for unlimited)</div>
                                </div>

                                <div class="mb-3">
                                    <label for="status" class="form-label">
                                        <i class="fas fa-toggle-on me-1"></i>Status
                                    </label>
                                    <select class="form-select" id="status" name="status">
                                        <option value="available" {% if menu_item.status == 'available' %}selected{% endif %}>Available</option>
                                        <option value="out_of_stock" {% if menu_item.status == 'out_of_stock' %}selected{% endif %}>Out of Stock</option>
                                        <option value="discontinued" {% if menu_item.status == 'discontinued' %}selected{% endif %}>Discontinued</option>
                                    </select>
                                    <div class="form-text">Set the availability status</div>
                                </div>

                                <div class="mb-3">
                                    <label for="preparation_time" class="form-label">
                                        <i class="fas fa-clock me-1"></i>Preparation Time (minutes)
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="preparation_time"
                                               name="preparation_time" min="1" max="180"
                                               value="{{ menu_item.preparation_time or '' }}" placeholder="15"
                                               data-validation="min:1|max:180">
                                        <span class="input-group-text">min</span>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Estimated preparation time</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Description & Details Section -->
                    <div class="form-section mb-4">
                        <h4 class="section-title">
                            <i class="fas fa-align-left"></i>
                            Description & Details
                        </h4>
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="description" class="form-label">
                                        <i class="fas fa-file-alt me-1"></i>Description
                                    </label>
                                    <textarea class="form-control" id="description" name="description" rows="4"
                                              placeholder="Describe the item, ingredients, preparation method, allergens, etc."
                                              data-validation="max:500">{{ menu_item.description or '' }}</textarea>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">
                                        <span id="descriptionCount">{{ (menu_item.description or '')|length }}</span>/500 characters
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="ingredients" class="form-label">
                                        <i class="fas fa-list me-1"></i>Ingredients
                                    </label>
                                    <textarea class="form-control" id="ingredients" name="ingredients" rows="3"
                                              placeholder="List main ingredients separated by commas"
                                              data-validation="max:300">{{ menu_item.ingredients or '' }}</textarea>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">
                                        <span id="ingredientsCount">{{ (menu_item.ingredients or '')|length }}</span>/300 characters
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="allergens" class="form-label">
                                                <i class="fas fa-exclamation-triangle me-1"></i>Allergens
                                            </label>
                                            <input type="text" class="form-control" id="allergens" name="allergens"
                                                   value="{{ menu_item.allergens or '' }}" placeholder="e.g., Nuts, Dairy, Gluten"
                                                   data-validation="max:100">
                                            <div class="invalid-feedback"></div>
                                            <div class="form-text">Common allergens present</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="calories" class="form-label">
                                                <i class="fas fa-fire me-1"></i>Calories (per serving)
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="calories" name="calories"
                                                       min="0" max="9999" value="{{ menu_item.calories or '' }}" placeholder="250"
                                                       data-validation="min:0|max:9999">
                                                <span class="input-group-text">kcal</span>
                                            </div>
                                            <div class="invalid-feedback"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="image" class="form-label">
                                        <i class="fas fa-image me-1"></i>Item Image
                                    </label>
                                    <div class="image-upload-area" id="imageUploadArea">
                                        <input type="file" class="form-control d-none" id="image" name="image"
                                               accept="image/png,image/jpg,image/jpeg,image/gif,image/webp"
                                               data-validation="file|max-size:16MB">

                                        <!-- Current Image Display -->
                                        {% if menu_item.image_url %}
                                        <div class="current-image" id="currentImageDisplay">
                                            <img src="{{ url_for('main.uploaded_file', filename='menu_images/' + menu_item.image_url) }}"
                                                 alt="{{ menu_item.name }}" class="preview-image" id="currentImg">
                                            <div class="image-overlay">
                                                <button type="button" class="btn btn-sm btn-outline-light" id="changeCurrentImage">
                                                    <i class="fas fa-edit me-1"></i>Change
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-danger" id="removeCurrentImage">
                                                    <i class="fas fa-trash me-1"></i>Remove
                                                </button>
                                            </div>
                                        </div>
                                        {% else %}
                                        <div class="upload-placeholder" id="uploadPlaceholder">
                                            <i class="fas fa-cloud-upload-alt fa-3x mb-3"></i>
                                            <p class="mb-2">Click to upload image</p>
                                            <p class="text-muted small">PNG, JPG, JPEG, GIF, WebP</p>
                                            <p class="text-muted small">Max size: 16MB</p>
                                        </div>
                                        {% endif %}

                                        <div class="image-preview" id="imagePreview" style="display: none;">
                                            <img id="previewImg" src="" alt="Preview" class="preview-image">
                                            <div class="image-overlay">
                                                <button type="button" class="btn btn-sm btn-outline-light" id="changeImage">
                                                    <i class="fas fa-edit me-1"></i>Change
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-danger" id="removeImage">
                                                    <i class="fas fa-trash me-1"></i>Remove
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Upload a new image to replace the current one</div>
                                </div>

                                <!-- Additional Options -->
                                <div class="mb-3">
                                    <label class="form-label">
                                        <i class="fas fa-star me-1"></i>Special Options
                                    </label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured"
                                               {% if menu_item.is_featured %}checked{% endif %}>
                                        <label class="form-check-label" for="is_featured">
                                            Featured Item
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="is_spicy" name="is_spicy"
                                               {% if menu_item.is_spicy %}checked{% endif %}>
                                        <label class="form-check-label" for="is_spicy">
                                            Spicy
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="is_vegetarian" name="is_vegetarian"
                                               {% if menu_item.is_vegetarian %}checked{% endif %}>
                                        <label class="form-check-label" for="is_vegetarian">
                                            Vegetarian
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="is_vegan" name="is_vegan"
                                               {% if menu_item.is_vegan %}checked{% endif %}>
                                        <label class="form-check-label" for="is_vegan">
                                            Vegan
                                        </label>
                                    </div>
                                </div>

                                <!-- Enhanced Item Statistics -->
                                <div class="mb-3">
                                    <div class="stats-card enhanced-stats-card">
                                        <div class="stats-header">
                                            <div class="stats-icon-wrapper">
                                                <i class="fas fa-chart-line"></i>
                                            </div>
                                            <h6 class="stats-title">
                                                Item Statistics
                                            </h6>
                                            <div class="stats-badge">
                                                <i class="fas fa-info-circle"></i>
                                            </div>
                                        </div>
                                        <div class="stats-grid enhanced-stats-grid">
                                            <div class="stat-item enhanced-stat-item">
                                                <div class="stat-icon created-icon">
                                                    <i class="fas fa-calendar-plus"></i>
                                                </div>
                                                <div class="stat-content">
                                                    <span class="stat-label">Created:</span>
                                                    <span class="stat-value created-date">{{ menu_item.created_at.strftime('%Y-%m-%d') }}</span>
                                                </div>
                                            </div>
                                            <div class="stat-item enhanced-stat-item">
                                                <div class="stat-icon updated-icon">
                                                    <i class="fas fa-calendar-plus"></i>
                                                </div>
                                                <div class="stat-content">
                                                    <span class="stat-label">Updated:</span>
                                                    <span class="stat-value updated-date">{{ menu_item.updated_at.strftime('%Y-%m-%d') }}</span>
                                                </div>
                                            </div>
                                            <div class="stat-item enhanced-stat-item">
                                                <div class="stat-icon stock-icon">
                                                    <i class="fas fa-boxes"></i>
                                                </div>
                                                <div class="stat-content">
                                                    <span class="stat-label">Current Stock:</span>
                                                    <span class="stat-value stock-value {% if menu_item.stock and menu_item.stock > 0 %}in-stock{% else %}unlimited{% endif %}">
                                                        {{ menu_item.stock if menu_item.stock and menu_item.stock > 0 else 'Unlimited' }}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="stat-item enhanced-stat-item">
                                                <div class="stat-icon status-icon">
                                                    <i class="fas fa-toggle-on"></i>
                                                </div>
                                                <div class="stat-content">
                                                    <span class="stat-label">Status:</span>
                                                    <span class="status-badge status-{{ menu_item.status }}" style="font-weight: bold;">
                                                        {% if menu_item.status == 'available' %}
                                                            <i class="fas fa-check-circle me-1"></i>Available
                                                        {% elif menu_item.status == 'out_of_stock' %}
                                                            <i class="fas fa-exclamation-triangle me-1"></i>Out of Stock
                                                        {% else %}
                                                            <i class="fas fa-times-circle me-1"></i>{{ menu_item.status|title }}
                                                        {% endif %}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Form Actions -->
                    <div class="form-actions enhanced-form-actions">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-summary enhanced-form-summary">
                                    <div class="summary-header">
                                        <div class="summary-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <h6 class="summary-title">Form Completion</h6>
                                    </div>
                                    <div class="progress enhanced-progress mb-3">
                                        <div class="progress-bar enhanced-progress-bar" id="completionProgress" 
                                             style="width: 85%" role="progressbar" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100">
                                            <span class="progress-text">85%</span>
                                        </div>
                                    </div>
                                    <div class="completion-status">
                                        <div class="status-indicator ready">
                                            <i class="fas fa-check me-2"></i>
                                            <span id="completionText">Ready to update!</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="action-buttons-container">
                                    <div class="action-buttons enhanced-action-buttons">
                                        <button type="button" class="btn btn-outline-info enhanced-preview-btn" id="previewBtn">
                                            <div class="btn-icon">
                                                <i class="fas fa-eye"></i>
                                            </div>
                                            <span class="btn-text">Preview</span>
                                            <div class="btn-shine"></div>
                                        </button>
                                        <button type="button" class="btn btn-outline-danger enhanced-delete-btn" id="deleteBtn">
                                            <div class="btn-icon">
                                                <i class="fas fa-trash"></i>
                                            </div>
                                            <span class="btn-text">Delete</span>
                                            <div class="btn-shine"></div>
                                        </button>
                                        <a href="{{ url_for('admin.menu_management') }}" class="btn btn-secondary enhanced-cancel-btn">
                                            <div class="btn-icon">
                                                <i class="fas fa-times"></i>
                                            </div>
                                            <span class="btn-text">Cancel</span>
                                            <div class="btn-shine"></div>
                                        </a>
                                        <button type="submit" class="btn btn-primary enhanced-submit-btn" id="submitBtn">
                                            <span class="spinner-border spinner-border-sm d-none me-2" id="submitSpinner"></span>
                                            <div class="btn-icon" id="submitIcon">
                                                <i class="fas fa-save"></i>
                                            </div>
                                            <span class="btn-text" id="submitText">Update Menu Item</span>
                                            <div class="btn-shine"></div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade bottom-modal" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content preview-modal">
            <div class="modal-header preview-header">
                <h5 class="modal-title">
                    <i class="fas fa-eye me-2"></i>Menu Item Preview
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal('previewModal')"></button>
            </div>
            <div class="modal-body preview-body">
                <div class="preview-container">
                    <div class="preview-image-section">
                        <div class="preview-image-container">
                            <img id="previewImage" src="" alt="Menu Item" class="preview-image">
                        </div>
                    </div>
                    <div class="preview-details-section">
                        <div class="preview-header-info">
                            <h2 id="previewName" class="preview-title"></h2>
                            <div class="preview-category-badge">
                                <i class="fas fa-tag me-1"></i>
                                <span id="previewCategory"></span>
                            </div>
                        </div>
                        
                        <div class="preview-price-section">
                            <span id="previewPrice" class="preview-price"></span>
                        </div>

                        <div class="preview-description-box">
                            <p id="previewDescription" class="preview-description"></p>
                        </div>

                        <div class="preview-info-grid">
                            <div class="info-item">
                                <i class="fas fa-box"></i>
                                <div class="info-content">
                                    <label>Stock</label>
                                    <span id="previewStock"></span>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-clock"></i>
                                <div class="info-content">
                                    <label>Prep Time</label>
                                    <span id="previewPrepTime"></span>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-fire"></i>
                                <div class="info-content">
                                    <label>Calories</label>
                                    <span id="previewCalories"></span>
                                </div>
                            </div>
                        </div>

                        <div class="preview-details-box">
                            <div class="details-section">
                                <h3><i class="fas fa-leaf me-2"></i>Ingredients</h3>
                                <p id="previewIngredients"></p>
                            </div>
                            <div class="details-section">
                                <h3><i class="fas fa-exclamation-triangle me-2"></i>Allergens</h3>
                                <p id="previewAllergens"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer preview-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('previewModal')">Close Preview</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade bottom-modal" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content enhanced-delete-modal">
            <div class="modal-header enhanced-delete-header">
                <div class="delete-header-content">
                    <div class="danger-icon-wrapper animated-pulse">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="delete-title-container">
                        <h5 class="modal-title text-white enhanced-delete-title">Confirm Delete</h5>
                        <p class="delete-subtitle">You are about to delete this item</p>
                    </div>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal('deleteModal')"></button>
            </div>
            <div class="modal-body enhanced-delete-body">
                <div class="delete-confirmation-content">
                    <div class="delete-item-info">
                        <div class="item-preview">
                            <div class="item-icon">
                                <i class="fas fa-utensils"></i>
                            </div>
                            <div class="item-details">
                                <h6 class="item-name">{{ menu_item.name }}</h6>
                                <p class="item-category text-muted">{{ menu_item.category.name if menu_item.category else 'No Category' }}</p>
                            </div>
                        </div>
                    </div>
                    <p class="delete-question">Are you sure you want to delete this menu item?</p>
                    <div class="alert alert-danger enhanced-warning">
                        <div class="warning-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="warning-content">
                            <strong>Warning:</strong> This action cannot be undone. All data associated with this menu item will be permanently deleted.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer enhanced-delete-footer">
                <button type="button" class="btn btn-secondary enhanced-cancel-btn" onclick="closeModal('deleteModal')">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <form method="POST" action="{{ url_for('admin.delete_menu_item', item_id=menu_item.item_id) }}" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn btn-danger enhanced-delete-btn">
                        <i class="fas fa-trash me-2"></i>Delete Item
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Category Modal -->
<div class="modal fade bottom-modal" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>Add New Category
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal('addCategoryModal')"></button>
            </div>
            <div class="modal-body">
                <form id="addCategoryForm">
                    <div class="mb-3">
                        <label for="newCategoryName" class="form-label">Category Name</label>
                        <input type="text" class="form-control" id="newCategoryName" required>
                    </div>
                    <div class="mb-3">
                        <label for="newCategoryDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="newCategoryDescription" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addCategoryModal')">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveCategoryBtn" onclick="saveCategory()">
                    <i class="fas fa-save me-2"></i>Add Category
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Optimized CSS for better performance */
html {
    scroll-behavior: auto; /* We'll handle smooth scrolling with JS */
    height: 100%;
}

body {
    overflow-y: auto;
    height: 100%;
    /* Use hardware acceleration for smoother scrolling */
    transform: translateZ(0);
    will-change: scroll-position;
    -webkit-font-smoothing: antialiased;
}

.modal-open {
    overflow: hidden;
}

.modal {
    overflow-y: auto;
    /* Use hardware acceleration for modals */
    transform: translateZ(0);
    will-change: transform, opacity;
    backface-visibility: hidden;
}

.modal-dialog {
    margin: 1.75rem auto;
    transition: transform 0.3s cubic-bezier(0.215, 0.610, 0.355, 1.000);
    will-change: transform;
}

/* Optimize animations for better performance */
@keyframes slideUp {
    from {
        transform: translateY(100px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes slideDown {
    from {
        transform: translateY(0);
        opacity: 1;
    }
    to {
        transform: translateY(100px);
        opacity: 0;
    }
}

/* Use hardware acceleration for animations */
.modal-content, .modal-dialog, .btn-shine {
    transform: translateZ(0);
    will-change: transform, opacity;
    backface-visibility: hidden;
}

/* Optimize form transitions */
.form-control, .form-select {
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

/* Optimize progress bar animation */
.progress-bar {
    transition: width 0.3s cubic-bezier(0.215, 0.610, 0.355, 1.000);
    will-change: width;
}

/* Optimize button hover effects */
.enhanced-action-buttons .btn {
    transition: transform 0.2s cubic-bezier(0.215, 0.610, 0.355, 1.000), 
                box-shadow 0.2s cubic-bezier(0.215, 0.610, 0.355, 1.000),
                background-color 0.2s ease;
}

/* Optimize image hover effects */
.image-overlay {
    transition: opacity 0.2s ease;
}

/* Optimize modal animations */
.modal.fade .modal-dialog {
    transform: translate(0, -30px);
    transition: transform 0.3s cubic-bezier(0.215, 0.610, 0.355, 1.000);
    will-change: transform;
}

.modal.show .modal-dialog {
    transform: translate(0, 0);
}

/* Optimize bottom modal animations */
.modal.bottom-modal .modal-dialog {
    transform: translate(0, 100%);
    transition: transform 0.3s cubic-bezier(0.215, 0.610, 0.355, 1.000);
    will-change: transform;
}

.modal.bottom-modal.show .modal-dialog {
    transform: translate(0, 0);
}

/* Reduce paint operations by using opacity for transitions */
.btn-shine {
    transition: left 0.4s cubic-bezier(0.215, 0.610, 0.355, 1.000);
    will-change: left;
}

/* Keep the rest of the styles but optimize animations */
/* ... existing styles ... */

/* Critical Z-index Fix - Optimized */
.modal {
    z-index: 1050 !important;
}

.modal-backdrop {
    z-index: 1040 !important;
    background-color: rgba(0, 0, 0, 0.5) !important;
    opacity: 0.5 !important;
}

.modal-dialog {
    z-index: 1060 !important;
    max-width: 90% !important;
    margin: 0.5rem auto !important;
}

.modal-content {
    z-index: 1070 !important;
    max-height: 80vh !important;
    overflow-y: auto !important;
}

/* Size adjustments - Optimized */
@media (min-width: 768px) {
    .modal-dialog {
        max-width: 600px !important;
    }
    
    .modal-dialog.modal-lg {
        max-width: 800px !important;
    }
}

/* Force pointer events - Optimized */
.modal-content * {
    pointer-events: auto !important;
}

/* Ensure buttons are clickable - Optimized */
.modal button,
.modal .btn,
.modal a,
.modal input[type="submit"] {
    position: relative !important;
    z-index: 1080 !important;
    pointer-events: auto !important;
}

/* Fix modal body size - Optimized */
.preview-body {
    max-height: 60vh !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
}

/* Make preview container more compact - Optimized */
.preview-container {
    display: flex;
    flex-direction: column;
}

.preview-image-section {
    height: 200px !important;
}

.preview-details-section {
    padding: 1rem !important;
}

.preview-info-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem !important;
}

.info-item {
    padding: 0.5rem !important;
}

.preview-description-box {
    padding: 0.75rem !important;
    margin-bottom: 0.75rem !important;
}

.preview-details-box {
    padding: 0.75rem !important;
}

.details-section {
    margin-bottom: 0.75rem !important;
}

/* Make delete modal more compact - Optimized */
.enhanced-delete-body {
    padding: 1rem !important;
}

.delete-item-info {
    padding: 1rem !important;
    margin-bottom: 1rem !important;
}

.delete-question {
    margin: 1rem 0 !important;
}

/* Extreme z-index override - Optimized */
#previewModal, #deleteModal, #addCategoryModal {
    z-index: 9999 !important;
}

/* The rest of the CSS remains the same */
</style>
{% endblock %}

{% block extra_js %}
<script>
// Enhanced Edit Menu Item JavaScript - Optimized for Performance
document.addEventListener('DOMContentLoaded', function() {
    // Cache DOM elements to avoid repeated lookups
    const previewModalEl = document.getElementById('previewModal');
    const deleteModalEl = document.getElementById('deleteModal');
    const addCategoryModalEl = document.getElementById('addCategoryModal');
    const formEl = document.getElementById('editMenuItemForm');
    const progressBarEl = document.getElementById('completionProgress');
    const progressTextEl = document.querySelector('.progress-text');
    const completionTextEl = document.getElementById('completionText');
    
    // Enable hardware-accelerated smooth scrolling
    document.documentElement.style.scrollBehavior = 'auto'; // We'll handle smooth scrolling manually
    
    // Remove existing backdrops for cleaner initialization
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => backdrop.remove());
    
    // Initialize modals with optimized settings
    const previewModal = new bootstrap.Modal(previewModalEl, {
        backdrop: false // Disable built-in backdrop for better performance
    });
    
    const deleteModal = new bootstrap.Modal(deleteModalEl, {
        backdrop: false
    });
    
    const addCategoryModal = new bootstrap.Modal(addCategoryModalEl, {
        backdrop: false
    });
    
    // Store modals in window object for global access with minimal overhead
    window.modals = { previewModal, deleteModal, addCategoryModal };
    
    // Use passive event listeners for better scroll performance
    previewModalEl.addEventListener('shown.bs.modal', function() {
        requestAnimationFrame(() => smoothScrollToModal('previewModal'));
    }, { passive: true });
    
    deleteModalEl.addEventListener('shown.bs.modal', function() {
        requestAnimationFrame(() => smoothScrollToModal('deleteModal'));
    }, { passive: true });
    
    addCategoryModalEl.addEventListener('shown.bs.modal', function() {
        requestAnimationFrame(() => smoothScrollToModal('addCategoryModal'));
    }, { passive: true });
    
    // Set up optimized event listeners for buttons - use event delegation where possible
    document.getElementById('previewBtn').addEventListener('click', function(e) {
        e.preventDefault();
        showPreview();
    }, { passive: false });
    
    document.getElementById('deleteBtn').addEventListener('click', function(e) {
        e.preventDefault();
        showDelete();
    }, { passive: false });
    
    document.getElementById('addCategoryBtn').addEventListener('click', function(e) {
        e.preventDefault();
        showAddCategory();
    }, { passive: false });
    
    // Fix all close buttons with event delegation
    document.body.addEventListener('click', function(e) {
        if (e.target.hasAttribute('data-bs-dismiss') || e.target.closest('[data-bs-dismiss="modal"]')) {
            e.preventDefault();
            const modalEl = e.target.closest('.modal');
            if (modalEl) closeModal(modalEl.id);
        }
    }, { passive: false });
    
    // Initialize progress bar
    updateProgress();
    
    // Set up event listeners for form fields with debounce
    if (formEl) {
        const formFields = formEl.querySelectorAll('input, select, textarea');
        formFields.forEach(field => {
            field.addEventListener('change', debounce(updateProgress, 200), { passive: true });
            field.addEventListener('input', debounce(updateProgress, 300), { passive: true });
        });
    }
    
    // Description counter with optimized updates
    const description = document.getElementById('description');
    const descriptionCount = document.getElementById('descriptionCount');
    if (description && descriptionCount) {
        description.addEventListener('input', debounce(function() {
            descriptionCount.textContent = description.value.length;
        }, 100), { passive: true });
    }
    
    // Ingredients counter with optimized updates
    const ingredients = document.getElementById('ingredients');
    const ingredientsCount = document.getElementById('ingredientsCount');
    if (ingredients && ingredientsCount) {
        ingredients.addEventListener('input', debounce(function() {
            ingredientsCount.textContent = ingredients.value.length;
        }, 100), { passive: true });
    }
    
    // Unlimited stock checkbox with optimized handling
    const unlimitedStock = document.getElementById('unlimitedStock');
    const stock = document.getElementById('stock');
    if (unlimitedStock && stock) {
        unlimitedStock.addEventListener('change', function() {
            stock.disabled = unlimitedStock.checked;
            if (unlimitedStock.checked) {
                stock.value = '0';
            }
            requestAnimationFrame(updateProgress);
        }, { passive: true });
    }
    
    // Image upload with optimized handlers
    initializeImageUpload();
});

// Debounce function for performance optimization
function debounce(func, wait) {
    let timeout;
    return function(...args) {
        const context = this;
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(context, args), wait);
    };
}

// Throttle function for performance-critical operations
function throttle(func, limit) {
    let inThrottle;
    return function(...args) {
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// Initialize image upload with optimized handlers
function initializeImageUpload() {
    const imageInput = document.getElementById('image');
    const uploadPlaceholder = document.getElementById('uploadPlaceholder');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const currentImageDisplay = document.getElementById('currentImageDisplay');
    
    // Use event delegation where possible
    if (uploadPlaceholder) {
        uploadPlaceholder.addEventListener('click', () => imageInput.click(), { passive: true });
    }
    
    if (imageInput) {
        imageInput.addEventListener('change', handleImageChange, { passive: true });
    }
    
    // Optimize event handlers for image controls
    const changeCurrentImage = document.getElementById('changeCurrentImage');
    if (changeCurrentImage) {
        changeCurrentImage.addEventListener('click', () => imageInput.click(), { passive: true });
    }
    
    const removeCurrentImage = document.getElementById('removeCurrentImage');
    if (removeCurrentImage) {
        removeCurrentImage.addEventListener('click', () => {
            console.log('Current image removed');
            requestAnimationFrame(updateProgress);
        }, { passive: true });
    }
    
    const changeImage = document.getElementById('changeImage');
    if (changeImage) {
        changeImage.addEventListener('click', () => imageInput.click(), { passive: true });
    }
    
    const removeImage = document.getElementById('removeImage');
    if (removeImage) {
        removeImage.addEventListener('click', () => {
            console.log('New image removed');
            requestAnimationFrame(updateProgress);
        }, { passive: true });
    }
}

// Handle image change with optimized processing
function handleImageChange(e) {
    console.log('Image changed');
    requestAnimationFrame(updateProgress);
}

// Update progress bar with optimized calculations
function updateProgress() {
    const progressBar = document.getElementById('completionProgress');
    const progressText = document.querySelector('.progress-text');
    const completionText = document.getElementById('completionText');
    const formFields = document.querySelectorAll('#editMenuItemForm input, #editMenuItemForm select, #editMenuItemForm textarea');
    
    if (!progressBar || !progressText || !completionText) return;
    
    // Field weights for progress calculation - cached for performance
    const fieldWeights = {
        'name': 15,
        'category_id': 15,
        'price': 15,
        'description': 10,
        'ingredients': 10,
        'image': 10,
        'stock': 5,
        'preparation_time': 5,
        'allergens': 5,
        'calories': 5,
        'status': 5
    };
    
    // Pre-calculate total weight for performance
    const totalWeight = 100; // Sum of all weights above
    
    let completedWeight = 0;
    
    // Calculate completed weight with optimized loop
    formFields.forEach(field => {
        const weight = fieldWeights[field.name];
        if (weight) {
            // Check if field has a value
            if (field.value && field.value.trim() !== '') {
                completedWeight += weight;
            }
            // Special case for image (already uploaded)
            if (field.name === 'image' && document.getElementById('currentImageDisplay')) {
                completedWeight += weight;
            }
        }
    });
    
    // Calculate percentage
    let percentage = Math.round((completedWeight / totalWeight) * 100);
    
    // Ensure minimum of 5% for visual feedback
    percentage = Math.max(5, percentage);
    
    // Update progress bar with optimized DOM updates
    progressBar.style.width = percentage + '%';
    progressBar.setAttribute('aria-valuenow', percentage);
    progressText.textContent = percentage + '%';
    
    // Update completion text and status indicator
    const statusIndicator = document.querySelector('.completion-status .status-indicator');
    if (!statusIndicator) return;
    
    // Remove all status classes first
    statusIndicator.classList.remove('ready', 'almost-ready', 'in-progress', 'needs-work');
    
    // Add appropriate class based on percentage
    if (percentage >= 100) {
        completionText.textContent = 'Ready to update!';
        statusIndicator.classList.add('ready');
    } else if (percentage >= 80) {
        completionText.textContent = 'Almost ready!';
        statusIndicator.classList.add('almost-ready');
    } else if (percentage >= 50) {
        completionText.textContent = 'Making good progress!';
        statusIndicator.classList.add('in-progress');
    } else {
        completionText.textContent = 'Please complete more fields';
        statusIndicator.classList.add('needs-work');
    }
}

// Show preview modal with optimized rendering
function showPreview() {
    // Get form values - cache DOM lookups
    const nameEl = document.getElementById('name');
    const categoryEl = document.getElementById('category_id');
    const descriptionEl = document.getElementById('description');
    const priceEl = document.getElementById('price');
    const stockEl = document.getElementById('stock');
    const prepTimeEl = document.getElementById('preparation_time');
    const caloriesEl = document.getElementById('calories');
    const ingredientsEl = document.getElementById('ingredients');
    const allergensEl = document.getElementById('allergens');
    
    // Get values with fallbacks
    const name = nameEl?.value || 'Untitled Item';
    const category = categoryEl?.selectedOptions[0]?.text || 'No Category';
    const description = descriptionEl?.value || 'No description provided';
    const price = priceEl?.value || '0.00';
    const stock = stockEl?.value || '0';
    const prepTime = prepTimeEl?.value || 'Not specified';
    const calories = caloriesEl?.value || 'Not specified';
    const ingredients = ingredientsEl?.value || 'Not specified';
    const allergens = allergensEl?.value || 'None specified';

    // Update preview modal content with optimized DOM updates
    const previewNameEl = document.getElementById('previewName');
    const previewCategoryEl = document.getElementById('previewCategory');
    const previewDescriptionEl = document.getElementById('previewDescription');
    const previewPriceEl = document.getElementById('previewPrice');
    const previewStockEl = document.getElementById('previewStock');
    const previewPrepTimeEl = document.getElementById('previewPrepTime');
    const previewCaloriesEl = document.getElementById('previewCalories');
    const previewIngredientsEl = document.getElementById('previewIngredients');
    const previewAllergensEl = document.getElementById('previewAllergens');
    
    // Batch DOM updates for better performance
    if (previewNameEl) previewNameEl.textContent = name;
    if (previewCategoryEl) previewCategoryEl.textContent = category;
    if (previewDescriptionEl) previewDescriptionEl.textContent = description;
    if (previewPriceEl) previewPriceEl.textContent = `EGP ${price}`;
    if (previewStockEl) previewStockEl.textContent = stock === '0' ? 'Unlimited' : stock;
    if (previewPrepTimeEl) previewPrepTimeEl.textContent = prepTime === 'Not specified' ? prepTime : `${prepTime} minutes`;
    if (previewCaloriesEl) previewCaloriesEl.textContent = calories === 'Not specified' ? calories : `${calories} kcal`;
    if (previewIngredientsEl) previewIngredientsEl.textContent = ingredients;
    if (previewAllergensEl) previewAllergensEl.textContent = allergens;

    // Handle image preview with optimized image loading
    const imageInput = document.getElementById('image');
    const previewContainer = document.querySelector('.preview-image-container');
    
    if (!previewContainer) return;
    
    // Clear previous content
    previewContainer.innerHTML = '';
    
    // Use createDocumentFragment for better performance
    const fragment = document.createDocumentFragment();
    let imgElement;
    
    if (imageInput && imageInput.files && imageInput.files[0]) {
        // New image selected - use createObjectURL for better performance
        imgElement = document.createElement('img');
        imgElement.src = URL.createObjectURL(imageInput.files[0]);
        imgElement.alt = "Menu Item";
        imgElement.className = "preview-image";
        imgElement.onload = () => URL.revokeObjectURL(imgElement.src); // Clean up memory
        fragment.appendChild(imgElement);
    } else if (document.getElementById('currentImageDisplay')) {
        // Existing image
        const currentImage = document.getElementById('currentImageDisplay').querySelector('img');
        if (currentImage) {
            imgElement = document.createElement('img');
            imgElement.src = currentImage.src;
            imgElement.alt = "Menu Item";
            imgElement.className = "preview-image";
            fragment.appendChild(imgElement);
        } else {
            showNoImagePlaceholder(fragment);
        }
    } else {
        // No image
        showNoImagePlaceholder(fragment);
    }
    
    // Append fragment to container in one operation
    previewContainer.appendChild(fragment);

    // Show modal with optimized rendering
    showOptimizedModal('previewModal');
}

// Show optimized modal with better performance
function showOptimizedModal(modalId) {
    // Create backdrop with optimized rendering
    const backdrop = createOptimizedBackdrop();
    
    // Get modal element
    const modalElement = document.getElementById(modalId);
    if (!modalElement) return;
    
    // Prepare modal with optimized settings
    modalElement.style.display = 'block';
    modalElement.style.zIndex = '9999';
    
    // Optimize modal dialog
    const modalDialog = modalElement.querySelector('.modal-dialog');
    if (modalDialog) {
        modalDialog.style.zIndex = '10000';
        modalDialog.style.transform = 'translate(0, 0)';
    }
    
    // Show modal with optimized animation
    if (window.modals && window.modals[modalId.replace('Modal', '') + 'Modal']) {
        window.modals[modalId.replace('Modal', '') + 'Modal'].show();
    }
    
    // Ensure modal is visible and scroll to it
    requestAnimationFrame(() => {
        ensureModalIsVisible(modalId);
        smoothScrollToModal(modalId);
    });
}

// Create optimized backdrop
function createOptimizedBackdrop() {
    // Remove existing backdrops
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => backdrop.remove());
    
    // Create transparent backdrop
    const backdrop = document.createElement('div');
    backdrop.className = 'modal-backdrop fade show';
    backdrop.style.opacity = '0.5'; // Make it visible but semi-transparent
    backdrop.style.background = 'rgba(0, 0, 0, 0.5)'; // Semi-transparent black
    backdrop.style.pointerEvents = 'auto'; // Allow clicks to close
    backdrop.style.zIndex = '1040';
    
    // Add to DOM
    document.body.appendChild(backdrop);
    
    // Add click handler to close modals
    backdrop.addEventListener('click', function() {
        // Find visible modal and close it
        const visibleModal = document.querySelector('.modal.show');
        if (visibleModal) closeModal(visibleModal.id);
    }, { passive: true });
    
    return backdrop;
}

// Show no image placeholder with optimized DOM creation
function showNoImagePlaceholder(container) {
    const placeholderDiv = document.createElement('div');
    placeholderDiv.className = 'no-image-placeholder';
    
    const icon = document.createElement('i');
    icon.className = 'fas fa-image';
    
    const text = document.createElement('p');
    text.textContent = 'No Image Available';
    
    placeholderDiv.appendChild(icon);
    placeholderDiv.appendChild(text);
    
    if (container instanceof DocumentFragment) {
        container.appendChild(placeholderDiv);
    } else {
        container.innerHTML = '';
        container.appendChild(placeholderDiv);
    }
}

// Ensure modal is visible with optimized rendering
function ensureModalIsVisible(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    
    // Force display with hardware acceleration
    modal.style.display = 'block';
    modal.style.zIndex = '9999';
    modal.style.transform = 'translateZ(0)';
    
    // Optimize modal dialog
    const modalDialog = modal.querySelector('.modal-dialog');
    if (modalDialog) {
        modalDialog.style.zIndex = '10000';
        modalDialog.style.transform = 'translateZ(0)';
        modalDialog.style.willChange = 'transform';
    }
    
    // Optimize modal content
    const modalContent = modal.querySelector('.modal-content');
    if (modalContent) {
        modalContent.style.zIndex = '10001';
        modalContent.style.transform = 'translateZ(0)';
        modalContent.style.willChange = 'transform';
    }
}

// Smooth scroll to modal with optimized animation
function smoothScrollToModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    
    // Get the modal's position with optimized calculations
    const rect = modal.getBoundingClientRect();
    const modalTop = rect.top + window.pageYOffset;
    const modalCenter = modalTop - (window.innerHeight / 2) + (rect.height / 2);
    
    // Use optimized smooth scrolling with cubic-bezier easing
    smoothScrollTo(modalCenter, 300);
}

// Optimized smooth scroll with requestAnimationFrame
function smoothScrollTo(targetY, duration) {
    // Early exit if already at target
    const startY = window.pageYOffset;
    if (Math.abs(startY - targetY) < 5) return;
    
    const difference = targetY - startY;
    let start;
    
    // Optimized easing function - cubic-bezier
    function easeOutQuint(t) {
        return 1 - Math.pow(1 - t, 5);
    }
    
    // Animation step with optimized rendering
    function step(timestamp) {
        if (!start) start = timestamp;
        const elapsed = timestamp - start;
        const progress = Math.min(elapsed / duration, 1);
        const ease = easeOutQuint(progress);
        
        window.scrollTo({
            top: startY + difference * ease,
            behavior: 'auto' // We're handling the animation manually
        });
        
        if (elapsed < duration) {
            window.requestAnimationFrame(step);
        }
    }
    
    // Start animation with requestAnimationFrame for better performance
    window.requestAnimationFrame(step);
}

// Show delete modal with optimized rendering
function showDelete() {
    // Get current item name and category for confirmation
    const name = document.getElementById('name')?.value || 'this menu item';
    const category = document.getElementById('category_id')?.selectedOptions[0]?.text || 'No Category';
    
    // Update delete confirmation text with optimized DOM updates
    const itemName = document.querySelector('#deleteModal .item-name');
    const itemCategory = document.querySelector('#deleteModal .item-category');
    const deleteQuestion = document.querySelector('#deleteModal .delete-question');
    
    if (itemName) itemName.textContent = name;
    if (itemCategory) itemCategory.textContent = category;
    if (deleteQuestion) deleteQuestion.textContent = `Are you sure you want to delete "${name}"?`;
    
    // Add warning animation
    const warningIcon = document.querySelector('#deleteModal .warning-icon');
    if (warningIcon) {
        warningIcon.classList.add('warning-pulse');
    }
    
    // Show modal with optimized rendering
    showOptimizedModal('deleteModal');
}

// Show add category modal with optimized rendering
function showAddCategory() {
    // Reset form with optimized DOM updates
    const addCategoryForm = document.getElementById('addCategoryForm');
    if (addCategoryForm) addCategoryForm.reset();
    
    // Show modal with optimized rendering
    showOptimizedModal('addCategoryModal');
}

// Close modal with optimized animation
function closeModal(modalId) {
    // Make backdrop semi-transparent
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
        backdrop.style.opacity = '0';
        backdrop.style.transition = 'opacity 0.3s ease';
    });
    
    // Get modal instance
    let modalInstance = null;
    if (window.modals && window.modals[modalId.replace('Modal', '') + 'Modal']) {
        modalInstance = window.modals[modalId.replace('Modal', '') + 'Modal'];
    } else {
        // Fallback
        const modalElement = document.getElementById(modalId);
        if (modalElement) modalInstance = bootstrap.Modal.getInstance(modalElement);
    }
    
    // Hide modal with optimized animation
    if (modalInstance) {
        modalInstance.hide();
        
        // Clean up after animation completes
        setTimeout(() => {
            document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
                backdrop.remove();
            });
        }, 300);
    }
    
    // Remove warning animation if it's the delete modal
    if (modalId === 'deleteModal') {
        const warningIcon = document.querySelector('#deleteModal .warning-icon');
        if (warningIcon) warningIcon.classList.remove('warning-pulse');
    }
}

// Save category with optimized processing
function saveCategory() {
    const categoryNameEl = document.getElementById('newCategoryName');
    const categoryDescriptionEl = document.getElementById('newCategoryDescription');
    
    if (!categoryNameEl || !categoryNameEl.value) {
        alert('Please enter a category name');
        return;
    }
    
    const categoryName = categoryNameEl.value;
    const categoryDescription = categoryDescriptionEl?.value || '';
    
    // Here you would typically make an AJAX call to save the category
    console.log('Saving category:', categoryName, categoryDescription);
    
    // Close modal with optimized animation
    closeModal('addCategoryModal');
}
</script>
{% endblock %}
