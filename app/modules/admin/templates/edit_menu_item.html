{% extends "base.html" %}

{% block title %}Edit Menu Item - Admin Dashboard{% endblock %}
{% block page_title %}Edit Menu Item{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="admin-card mb-4">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h2 class="card-title">
                <i class="fas fa-edit"></i>
                Edit Menu Item
            </h2>
            <a href="{{ url_for('admin.menu_management') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Menu
            </a>
        </div>
    </div>
</div>

<!-- Form Section -->
<div class="row justify-content-center">
    <div class="col-md-12 col-lg-10">
        <div class="admin-card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-utensils"></i>
                    Edit Menu Item: {{ menu_item.name }}
                </h3>
                <div class="form-progress">
                    <div class="progress-bar" id="formProgress"></div>
                </div>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data" id="editMenuItemForm" novalidate>
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                    <!-- Basic Information Section -->
                    <div class="form-section mb-4">
                        <h4 class="section-title">
                            <i class="fas fa-info-circle"></i>
                            Basic Information
                        </h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="name" class="form-label">
                                        <i class="fas fa-tag me-1"></i>Item Name <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="name" name="name" required
                                           value="{{ menu_item.name }}" placeholder="e.g., Grilled Chicken, Fresh Orange Juice"
                                           data-validation="required|min:2|max:100">
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Enter a descriptive name for your menu item</div>
                                </div>

                                <div class="mb-3">
                                    <label for="category_id" class="form-label">
                                        <i class="fas fa-folder me-1"></i>Category <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <select class="form-select" id="category_id" name="category_id" required
                                                data-validation="required">
                                            <option value="">Select a category</option>
                                            {% for category in categories %}
                                            <option value="{{ category.category_id }}"
                                                    {% if category.category_id == menu_item.category_id %}selected{% endif %}>
                                                {{ category.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <button type="button" class="btn btn-outline-secondary" id="addCategoryBtn"
                                                title="Add New Category">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Choose the appropriate category for this item</div>
                                </div>

                                <div class="mb-3">
                                    <label for="price" class="form-label">
                                        <i class="fas fa-dollar-sign me-1"></i>Price (EGP) <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">EGP</span>
                                        <input type="number" class="form-control" id="price" name="price"
                                               step="0.01" min="0.01" required value="{{ menu_item.price }}" placeholder="0.00"
                                               data-validation="required|min:0.01|max:9999.99">
                                        <button type="button" class="btn btn-outline-info" id="priceCalculator"
                                                title="Price Calculator">
                                            <i class="fas fa-calculator"></i>
                                        </button>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Set the selling price for this item</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="stock" class="form-label">
                                        <i class="fas fa-boxes me-1"></i>Stock Quantity
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="stock" name="stock"
                                               min="0" value="{{ menu_item.stock }}" placeholder="0"
                                               data-validation="min:0|max:99999">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="checkbox" id="unlimitedStock"
                                                   {% if menu_item.stock == 0 %}checked{% endif %}>
                                            <label class="form-check-label ms-1" for="unlimitedStock">Unlimited</label>
                                        </div>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Current stock quantity (0 for unlimited)</div>
                                </div>

                                <div class="mb-3">
                                    <label for="status" class="form-label">
                                        <i class="fas fa-toggle-on me-1"></i>Status
                                    </label>
                                    <select class="form-select" id="status" name="status">
                                        <option value="available" {% if menu_item.status == 'available' %}selected{% endif %}>Available</option>
                                        <option value="out_of_stock" {% if menu_item.status == 'out_of_stock' %}selected{% endif %}>Out of Stock</option>
                                        <option value="discontinued" {% if menu_item.status == 'discontinued' %}selected{% endif %}>Discontinued</option>
                                    </select>
                                    <div class="form-text">Set the availability status</div>
                                </div>

                                <div class="mb-3">
                                    <label for="preparation_time" class="form-label">
                                        <i class="fas fa-clock me-1"></i>Preparation Time (minutes)
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="preparation_time"
                                               name="preparation_time" min="1" max="180"
                                               value="{{ menu_item.preparation_time or '' }}" placeholder="15"
                                               data-validation="min:1|max:180">
                                        <span class="input-group-text">min</span>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Estimated preparation time</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Description & Details Section -->
                    <div class="form-section mb-4">
                        <h4 class="section-title">
                            <i class="fas fa-align-left"></i>
                            Description & Details
                        </h4>
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="description" class="form-label">
                                        <i class="fas fa-file-alt me-1"></i>Description
                                    </label>
                                    <textarea class="form-control" id="description" name="description" rows="4"
                                              placeholder="Describe the item, ingredients, preparation method, allergens, etc."
                                              data-validation="max:500">{{ menu_item.description or '' }}</textarea>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">
                                        <span id="descriptionCount">{{ (menu_item.description or '')|length }}</span>/500 characters
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="ingredients" class="form-label">
                                        <i class="fas fa-list me-1"></i>Ingredients
                                    </label>
                                    <textarea class="form-control" id="ingredients" name="ingredients" rows="3"
                                              placeholder="List main ingredients separated by commas"
                                              data-validation="max:300">{{ menu_item.ingredients or '' }}</textarea>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">
                                        <span id="ingredientsCount">{{ (menu_item.ingredients or '')|length }}</span>/300 characters
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="allergens" class="form-label">
                                                <i class="fas fa-exclamation-triangle me-1"></i>Allergens
                                            </label>
                                            <input type="text" class="form-control" id="allergens" name="allergens"
                                                   value="{{ menu_item.allergens or '' }}" placeholder="e.g., Nuts, Dairy, Gluten"
                                                   data-validation="max:100">
                                            <div class="invalid-feedback"></div>
                                            <div class="form-text">Common allergens present</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="calories" class="form-label">
                                                <i class="fas fa-fire me-1"></i>Calories (per serving)
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="calories" name="calories"
                                                       min="0" max="9999" value="{{ menu_item.calories or '' }}" placeholder="250"
                                                       data-validation="min:0|max:9999">
                                                <span class="input-group-text">kcal</span>
                                            </div>
                                            <div class="invalid-feedback"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="image" class="form-label">
                                        <i class="fas fa-image me-1"></i>Item Image
                                    </label>
                                    <div class="image-upload-area" id="imageUploadArea">
                                        <input type="file" class="form-control d-none" id="image" name="image"
                                               accept="image/png,image/jpg,image/jpeg,image/gif,image/webp"
                                               data-validation="file|max-size:16MB">

                                        <!-- Current Image Display -->
                                        {% if menu_item.image_url %}
                                        <div class="current-image" id="currentImageDisplay">
                                            <img src="{{ url_for('main.uploaded_file', filename='menu_images/' + menu_item.image_url) }}"
                                                 alt="{{ menu_item.name }}" class="preview-image" id="currentImg">
                                            <div class="image-overlay">
                                                <button type="button" class="btn btn-sm btn-outline-light" id="changeCurrentImage">
                                                    <i class="fas fa-edit me-1"></i>Change
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-danger" id="removeCurrentImage">
                                                    <i class="fas fa-trash me-1"></i>Remove
                                                </button>
                                            </div>
                                        </div>
                                        {% else %}
                                        <div class="upload-placeholder" id="uploadPlaceholder">
                                            <i class="fas fa-cloud-upload-alt fa-3x mb-3"></i>
                                            <p class="mb-2">Click to upload image</p>
                                            <p class="text-muted small">PNG, JPG, JPEG, GIF, WebP</p>
                                            <p class="text-muted small">Max size: 16MB</p>
                                        </div>
                                        {% endif %}

                                        <div class="image-preview" id="imagePreview" style="display: none;">
                                            <img id="previewImg" src="" alt="Preview" class="preview-image">
                                            <div class="image-overlay">
                                                <button type="button" class="btn btn-sm btn-outline-light" id="changeImage">
                                                    <i class="fas fa-edit me-1"></i>Change
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-danger" id="removeImage">
                                                    <i class="fas fa-trash me-1"></i>Remove
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">Upload a new image to replace the current one</div>
                                </div>

                                <!-- Additional Options -->
                                <div class="mb-3">
                                    <label class="form-label">
                                        <i class="fas fa-star me-1"></i>Special Options
                                    </label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured"
                                               {% if menu_item.is_featured %}checked{% endif %}>
                                        <label class="form-check-label" for="is_featured">
                                            Featured Item
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="is_spicy" name="is_spicy"
                                               {% if menu_item.is_spicy %}checked{% endif %}>
                                        <label class="form-check-label" for="is_spicy">
                                            Spicy
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="is_vegetarian" name="is_vegetarian"
                                               {% if menu_item.is_vegetarian %}checked{% endif %}>
                                        <label class="form-check-label" for="is_vegetarian">
                                            Vegetarian
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="is_vegan" name="is_vegan"
                                               {% if menu_item.is_vegan %}checked{% endif %}>
                                        <label class="form-check-label" for="is_vegan">
                                            Vegan
                                        </label>
                                    </div>
                                </div>

                                <!-- Enhanced Item Statistics -->
                                <div class="mb-3">
                                    <div class="stats-card enhanced-stats-card">
                                        <div class="stats-header">
                                            <div class="stats-icon-wrapper">
                                                <i class="fas fa-chart-line"></i>
                                            </div>
                                            <h6 class="stats-title">
                                                Item Statistics
                                            </h6>
                                            <div class="stats-badge">
                                                <i class="fas fa-info-circle"></i>
                                            </div>
                                        </div>
                                        <div class="stats-grid enhanced-stats-grid">
                                            <div class="stat-item enhanced-stat-item">
                                                <div class="stat-icon created-icon">
                                                    <i class="fas fa-calendar-plus"></i>
                                                </div>
                                                <div class="stat-content">
                                                    <span class="stat-label">Created:</span>
                                                    <span class="stat-value created-date">{{ menu_item.created_at.strftime('%Y-%m-%d') }}</span>
                                                </div>
                                            </div>
                                            <div class="stat-item enhanced-stat-item">
                                                <div class="stat-icon updated-icon">
                                                    <i class="fas fa-calendar-plus"></i>
                                                </div>
                                                <div class="stat-content">
                                                    <span class="stat-label">Updated:</span>
                                                    <span class="stat-value updated-date">{{ menu_item.updated_at.strftime('%Y-%m-%d') }}</span>
                                                </div>
                                            </div>
                                            <div class="stat-item enhanced-stat-item">
                                                <div class="stat-icon stock-icon">
                                                    <i class="fas fa-boxes"></i>
                                                </div>
                                                <div class="stat-content">
                                                    <span class="stat-label">Current Stock:</span>
                                                    <span class="stat-value stock-value {% if menu_item.stock and menu_item.stock > 0 %}in-stock{% else %}unlimited{% endif %}">
                                                        {{ menu_item.stock if menu_item.stock and menu_item.stock > 0 else 'Unlimited' }}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="stat-item enhanced-stat-item">
                                                <div class="stat-icon status-icon">
                                                    <i class="fas fa-toggle-on"></i>
                                                </div>
                                                <div class="stat-content">
                                                    <span class="stat-label">Status:</span>
                                                    <span class="status-badge status-{{ menu_item.status }}" style="font-weight: bold;">
                                                        {% if menu_item.status == 'available' %}
                                                            <i class="fas fa-check-circle me-1"></i>Available
                                                        {% elif menu_item.status == 'out_of_stock' %}
                                                            <i class="fas fa-exclamation-triangle me-1"></i>Out of Stock
                                                        {% else %}
                                                            <i class="fas fa-times-circle me-1"></i>{{ menu_item.status|title }}
                                                        {% endif %}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Form Actions -->
                    <div class="form-actions enhanced-form-actions">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-summary enhanced-form-summary">
                                    <div class="summary-header">
                                        <div class="summary-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <h6 class="summary-title">Form Completion</h6>
                                    </div>
                                    <div class="progress enhanced-progress mb-3">
                                        <div class="progress-bar enhanced-progress-bar" id="completionProgress" 
                                             style="width: 85%" role="progressbar" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100">
                                            <span class="progress-text">85%</span>
                                        </div>
                                    </div>
                                    <div class="completion-status">
                                        <div class="status-indicator ready">
                                            <i class="fas fa-check me-2"></i>
                                            <span id="completionText">Ready to update!</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="action-buttons-container">
                                    <div class="action-buttons enhanced-action-buttons">
                                        <button type="button" class="btn btn-outline-info enhanced-preview-btn" id="previewBtn">
                                            <div class="btn-icon">
                                                <i class="fas fa-eye"></i>
                                            </div>
                                            <span class="btn-text">Preview</span>
                                            <div class="btn-shine"></div>
                                        </button>
                                        <button type="button" class="btn btn-outline-danger enhanced-delete-btn" id="deleteBtn">
                                            <div class="btn-icon">
                                                <i class="fas fa-trash"></i>
                                            </div>
                                            <span class="btn-text">Delete</span>
                                            <div class="btn-shine"></div>
                                        </button>
                                        <a href="{{ url_for('admin.menu_management') }}" class="btn btn-secondary enhanced-cancel-btn">
                                            <div class="btn-icon">
                                                <i class="fas fa-times"></i>
                                            </div>
                                            <span class="btn-text">Cancel</span>
                                            <div class="btn-shine"></div>
                                        </a>
                                        <button type="submit" class="btn btn-primary enhanced-submit-btn" id="submitBtn">
                                            <span class="spinner-border spinner-border-sm d-none me-2" id="submitSpinner"></span>
                                            <div class="btn-icon" id="submitIcon">
                                                <i class="fas fa-save"></i>
                                            </div>
                                            <span class="btn-text" id="submitText">Update Menu Item</span>
                                            <div class="btn-shine"></div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade bottom-modal" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content preview-modal">
            <div class="modal-header preview-header">
                <h5 class="modal-title">
                    <i class="fas fa-eye me-2"></i>Menu Item Preview
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal('previewModal')"></button>
            </div>
            <div class="modal-body preview-body">
                <div class="preview-container">
                    <div class="preview-image-section">
                        <div class="preview-image-container">
                            <img id="previewImage" src="" alt="Menu Item" class="preview-image">
                        </div>
                    </div>
                    <div class="preview-details-section">
                        <div class="preview-header-info">
                            <h2 id="previewName" class="preview-title"></h2>
                            <div class="preview-category-badge">
                                <i class="fas fa-tag me-1"></i>
                                <span id="previewCategory"></span>
                            </div>
                        </div>
                        
                        <div class="preview-price-section">
                            <span id="previewPrice" class="preview-price"></span>
                        </div>

                        <div class="preview-description-box">
                            <p id="previewDescription" class="preview-description"></p>
                        </div>

                        <div class="preview-info-grid">
                            <div class="info-item">
                                <i class="fas fa-box"></i>
                                <div class="info-content">
                                    <label>Stock</label>
                                    <span id="previewStock"></span>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-clock"></i>
                                <div class="info-content">
                                    <label>Prep Time</label>
                                    <span id="previewPrepTime"></span>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-fire"></i>
                                <div class="info-content">
                                    <label>Calories</label>
                                    <span id="previewCalories"></span>
                                </div>
                            </div>
                        </div>

                        <div class="preview-details-box">
                            <div class="details-section">
                                <h3><i class="fas fa-leaf me-2"></i>Ingredients</h3>
                                <p id="previewIngredients"></p>
                            </div>
                            <div class="details-section">
                                <h3><i class="fas fa-exclamation-triangle me-2"></i>Allergens</h3>
                                <p id="previewAllergens"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer preview-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('previewModal')">Close Preview</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade bottom-modal" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content enhanced-delete-modal">
            <div class="modal-header enhanced-delete-header">
                <h5 class="modal-title text-danger enhanced-delete-title">
                    <div class="danger-icon-wrapper">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <span>Confirm Delete</span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal('deleteModal')"></button>
            </div>
            <div class="modal-body enhanced-delete-body">
                <div class="delete-confirmation-content">
                    <div class="delete-item-info">
                        <div class="item-preview">
                            <div class="item-icon">
                                <i class="fas fa-utensils"></i>
                            </div>
                            <div class="item-details">
                                <h6 class="item-name">{{ menu_item.name }}</h6>
                                <p class="item-category text-muted">{{ menu_item.category.name if menu_item.category else 'No Category' }}</p>
                            </div>
                        </div>
                    </div>
                    <p class="delete-question">Are you sure you want to delete this menu item?</p>
                    <div class="alert alert-danger enhanced-warning">
                        <div class="warning-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="warning-content">
                            <strong>Warning:</strong> This action cannot be undone. All data associated with this menu item will be permanently deleted.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer enhanced-delete-footer">
                <button type="button" class="btn btn-secondary enhanced-cancel-btn" onclick="closeModal('deleteModal')">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <form method="POST" action="{{ url_for('admin.delete_menu_item', item_id=menu_item.item_id) }}" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn btn-danger enhanced-delete-btn">
                        <i class="fas fa-trash me-2"></i>Delete Item
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Category Modal -->
<div class="modal fade bottom-modal" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>Add New Category
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal('addCategoryModal')"></button>
            </div>
            <div class="modal-body">
                <form id="addCategoryForm">
                    <div class="mb-3">
                        <label for="newCategoryName" class="form-label">Category Name</label>
                        <input type="text" class="form-control" id="newCategoryName" required>
                    </div>
                    <div class="mb-3">
                        <label for="newCategoryDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="newCategoryDescription" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addCategoryModal')">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveCategoryBtn" onclick="saveCategory()">
                    <i class="fas fa-save me-2"></i>Add Category
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Enhanced Edit Menu Item Styles */
.form-section {
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1.5rem;
    background: rgba(var(--primary-yellow-rgb), 0.02);
    position: relative;
}

.section-title {
    color: var(--primary-dark);
    font-weight: 600;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--primary-yellow);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-title i {
    color: var(--primary-yellow);
    font-size: 1.2rem;
}

.form-progress {
    height: 4px;
    background: rgba(var(--primary-yellow-rgb), 0.2);
    border-radius: 2px;
    margin-top: 1rem;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-yellow) 0%, #e6b800 100%);
    border-radius: 2px;
    transition: width 0.3s ease;
    width: 75%; /* Default for edit form */
}

.form-label {
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.form-label i {
    color: var(--primary-yellow);
    width: 16px;
}

.form-control, .form-select {
    border-radius: 8px;
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
    font-size: 0.95rem;
}

.form-control:focus, .form-select:focus {
    border-color: var(--primary-yellow);
    box-shadow: 0 0 0 0.2rem rgba(var(--primary-yellow-rgb), 0.25);
}

.form-control.is-valid {
    border-color: var(--success-green);
}

.form-control.is-invalid {
    border-color: var(--danger-red);
}

.input-group-text {
    background: var(--primary-yellow);
    color: var(--text-dark);
    border-color: var(--primary-yellow);
    font-weight: 600;
}

/* Image Upload Styling */
.image-upload-area {
    border: 2px dashed var(--border-color);
    border-radius: 12px;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    min-height: 250px;
}

.image-upload-area:hover {
    border-color: var(--primary-yellow);
    background: rgba(var(--primary-yellow-rgb), 0.05);
}

.upload-placeholder {
    padding: 2rem;
    text-align: center;
    color: var(--text-muted);
    transition: all 0.3s ease;
    height: 250px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.current-image, .image-preview {
    position: relative;
    width: 100%;
    height: 250px;
}

.preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
}

.image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 10px;
}

.current-image:hover .image-overlay,
.image-preview:hover .image-overlay {
    opacity: 1;
}

/* Stats Card */
.stats-card {
    background: white;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.stats-title {
    color: var(--primary-dark);
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.stats-title i {
    color: var(--primary-yellow);
}

.stats-grid {
    display: grid;
    gap: 0.75rem;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid #f0f0f0;
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-label {
    font-weight: 500;
    color: var(--text-muted);
}

.stat-value {
    font-weight: 600;
    color: var(--text-dark);
}

.stat-value.status-available {
    color: var(--success-green);
}

.stat-value.status-out_of_stock {
    color: var(--warning-orange);
}

.stat-value.status-discontinued {
    color: var(--danger-red);
}

/* Enhanced Stats Card */
.enhanced-stats-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
    position: relative;
    overflow: hidden;
    margin-bottom: 2rem;
}

.enhanced-stats-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary-yellow);
}

.stats-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid rgba(var(--primary-yellow-rgb), 0.2);
}

.stats-icon-wrapper {
    background: var(--primary-yellow);
    padding: 12px;
    border-radius: 12px;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3);
}

.stats-title {
    color: var(--text-dark);
    font-weight: 700;
    margin: 0;
    font-size: 1.3rem;
    letter-spacing: 0.5px;
}

.stats-badge {
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.95rem;
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-shadow: 0px 1px 1px rgba(0, 0, 0, 0.2);
    margin-top: 10px;
    letter-spacing: 0.5px;
    min-width: 120px;
}

.stats-badge i {
    margin-right: 6px;
    font-size: 1.1rem;
}

.stats-badge.status-available {
    background: var(--success-green);
    color: white !important;
    box-shadow: 0 3px 10px rgba(40, 167, 69, 0.4);
    font-weight: bold;
}

.stats-badge.status-out_of_stock {
    background: var(--primary-yellow);
    color: black !important;
    box-shadow: 0 3px 10px rgba(var(--primary-yellow-rgb), 0.4);
    text-shadow: none;
}

.stats-badge.status-discontinued {
    background: var(--danger-red);
    color: white !important;
    box-shadow: 0 3px 10px rgba(220, 53, 69, 0.4);
    font-weight: bold;
}

.enhanced-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.enhanced-stat-item {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
    border: 2px solid rgba(var(--primary-yellow-rgb), 0.1);
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 1rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.enhanced-stat-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.6s;
}

.enhanced-stat-item:hover::before {
    left: 100%;
}

.enhanced-stat-item:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 12px 30px rgba(var(--primary-yellow-rgb), 0.2);
    border-color: var(--primary-yellow);
}

.stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    color: var(--text-dark);
    flex-shrink: 0;
    position: relative;
    z-index: 1;
}

.created-icon {
    background: var(--primary-yellow);
    box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3);
}

.updated-icon {
    background: var(--primary-yellow);
    box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3);
}

.stock-icon {
    background: var(--primary-yellow);
    box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3);
}

.status-icon {
    background: var(--primary-yellow);
    box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3);
}

.stat-content {
    flex: 1;
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.enhanced-stat-item .stat-label {
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 4px;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-align: center;
}

.enhanced-stat-item .stat-value {
    font-weight: 700;
    color: var(--text-dark);
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.stat-value.in-stock {
    color: var(--success-green);
}

.stat-value.unlimited {
    color: var(--primary-yellow);
}

.status-badge {
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.95rem;
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-shadow: 0px 1px 1px rgba(0, 0, 0, 0.2);
    margin-top: 10px;
    letter-spacing: 0.5px;
    min-width: 120px;
}

.status-badge i {
    margin-right: 6px;
    font-size: 1.1rem;
}

.status-badge.status-available {
    background: var(--success-green);
    color: white !important;
    box-shadow: 0 3px 10px rgba(40, 167, 69, 0.4);
    font-weight: bold;
}

.status-badge.status-out_of_stock {
    background: var(--primary-yellow);
    color: black !important;
    box-shadow: 0 3px 10px rgba(var(--primary-yellow-rgb), 0.4);
    text-shadow: none;
}

.status-badge.status-discontinued {
    background: var(--danger-red);
    color: white !important;
    box-shadow: 0 3px 10px rgba(220, 53, 69, 0.4);
    font-weight: bold;
}

/* Enhanced Form Actions */
.enhanced-form-actions {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border: 2px solid rgba(var(--primary-yellow-rgb), 0.1);
    border-radius: 20px;
    padding: 2.5rem;
    margin-top: 3rem;
    position: relative;
    overflow: hidden;
}

.enhanced-form-actions::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary-yellow);
}

.enhanced-form-summary {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
    border: 2px solid rgba(var(--primary-yellow-rgb), 0.1);
    border-radius: 16px;
    padding: 2rem;
    height: 100%;
}

.summary-header {
    display: flex;
    align-items: center;
    margin-bottom: 1.5rem;
}

.summary-icon {
    background: var(--primary-yellow);
    padding: 12px;
    border-radius: 12px;
    color: var(--text-dark);
    margin-right: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3);
}

.summary-title {
    color: var(--text-dark);
    font-weight: 700;
    margin: 0;
    font-size: 1.2rem;
}

.enhanced-progress {
    height: 12px;
    background: rgba(var(--primary-yellow-rgb), 0.1);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    margin-bottom: 1.5rem;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
}

.enhanced-progress-bar {
    background: var(--primary-yellow);
    border-radius: 10px;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-dark);
    font-weight: 600;
    font-size: 0.85rem;
    box-shadow: 0 1px 3px rgba(var(--primary-yellow-rgb), 0.3);
}

.enhanced-progress-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: progressShine 2s infinite;
}

@keyframes progressShine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.completion-status {
    text-align: center;
}

.status-indicator {
    display: inline-flex;
    align-items: center;
    padding: 12px 20px;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.95rem;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 250px;
    justify-content: center;
    position: relative;
    overflow: hidden;
    animation: statusPulse 2s infinite;
}

.status-indicator i {
    margin-right: 8px;
    font-size: 1.1rem;
}

.status-indicator.ready {
    background: var(--primary-yellow);
    color: var(--text-dark);
    box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3);
    animation: readyPulse 2s infinite;
}

.status-indicator.almost-ready {
    background: var(--primary-yellow);
    color: var(--text-dark);
    box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3);
}

.status-indicator.in-progress {
    background: #f8f9fa;
    color: var(--text-dark);
    border: 2px solid var(--primary-yellow);
}

.status-indicator.needs-work {
    background: #f8f9fa;
    color: var(--text-dark);
    border: 2px dashed var(--primary-yellow);
}

@keyframes statusPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

@keyframes readyPulse {
    0% { box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3); }
    50% { box-shadow: 0 4px 20px rgba(var(--primary-yellow-rgb), 0.5); }
    100% { box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3); }
}

/* Enhanced Action Buttons */
.action-buttons-container {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    height: 100%;
}

.enhanced-action-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
}

.enhanced-action-buttons .btn {
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    padding: 12px 24px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 2px solid;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 120px;
    justify-content: center;
}

.btn-icon {
    font-size: 1.1rem;
    transition: transform 0.3s ease;
}

.btn-text {
    font-size: 0.9rem;
}

.btn-shine {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.6s;
}

.enhanced-action-buttons .btn:hover .btn-shine {
    left: 100%;
}

.enhanced-action-buttons .btn:hover .btn-icon {
    transform: translateY(-2px);
}

.enhanced-preview-btn {
    border-color: #17a2b8;
    color: #17a2b8;
    background: linear-gradient(135deg, #ffffff 0%, #e8f7fa 100%);
}

.enhanced-preview-btn:hover {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: white;
    border-color: #17a2b8;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(23, 162, 184, 0.4);
}

.enhanced-delete-btn {
    border-color: #dc3545;
    color: #dc3545;
    background: linear-gradient(135deg, #ffffff 0%, #fdf2f2 100%);
}

.enhanced-delete-btn:hover {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
    border-color: #dc3545;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
}

.enhanced-cancel-btn {
    border-color: #6c757d;
    color: #6c757d;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    text-decoration: none;
}

.enhanced-cancel-btn:hover {
    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
    color: white;
    border-color: #6c757d;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
    text-decoration: none;
}

.enhanced-submit-btn {
    background: var(--primary-yellow);
    border-color: var(--primary-yellow);
    color: var(--text-dark);
    box-shadow: 0 4px 15px rgba(var(--primary-yellow-rgb), 0.3);
}

.enhanced-submit-btn:hover {
    background: var(--primary-yellow-dark);
    border-color: var(--primary-yellow-dark);
    color: var(--text-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(var(--primary-yellow-rgb), 0.4);
}

.enhanced-submit-btn:disabled {
    opacity: 0.7;
    transform: none;
    box-shadow: none;
    cursor: not-allowed;
}

/* Enhanced Delete Modal Styles */
.enhanced-delete-modal {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
}

.enhanced-delete-header {
    background: var(--danger-red);
    color: white;
    padding: 1.5rem;
    border: none;
}

.enhanced-delete-title {
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    color: white;
}

.danger-icon-wrapper {
    background: rgba(255, 255, 255, 0.2);
    padding: 10px;
    border-radius: 50%;
    margin-right: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-close-white {
    filter: brightness(0) invert(1);
}

.enhanced-delete-body {
    padding: 2rem;
}

.delete-confirmation-content {
    text-align: center;
}

.delete-item-info {
    background: rgba(220, 53, 69, 0.1);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.item-preview {
    display: flex;
    align-items: center;
    gap: 1rem;
    justify-content: center;
}

.item-icon {
    background: #dc3545;
    color: white;
    width: 48px;
    height: 48px;
    border-radius: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
}

.item-details {
    text-align: left;
}

.item-name {
    margin: 0;
    font-weight: 600;
    color: #dc3545;
}

.item-category {
    margin: 0;
    font-size: 0.9rem;
}

.delete-question {
    font-size: 1.1rem;
    font-weight: 500;
    margin: 1.5rem 0;
}

.enhanced-warning {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    text-align: left;
    margin-bottom: 0;
}

.warning-icon {
    color: #dc3545;
    font-size: 1.25rem;
    flex-shrink: 0;
}

.enhanced-delete-footer {
    background: #f8f9fa;
    border-top: 1px solid #dee2e6;
    border-radius: 0 0 8px 8px;
    padding: 1rem;
}

.preview-footer .btn {
    padding: 0.5rem 1.5rem;
    font-weight: 500;
}

@media (max-width: 768px) {
    .preview-header-info {
        flex-direction: column;
    }

    .preview-category-badge {
        align-self: flex-start;
    }

    .preview-info-grid {
        grid-template-columns: 1fr;
    }
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1050;
    width: 100%;
    height: 100%;
    overflow: hidden;
    outline: 0;
}

.modal.fade .modal-dialog {
    transform: translate(0, -50px);
    transition: transform 0.3s ease-out;
}

.modal.show .modal-dialog {
    transform: none;
}

.modal-dialog {
    position: relative;
    width: auto;
    margin: 0.5rem;
    pointer-events: none;
    max-width: 800px;
    margin: 1.75rem auto;
}

.modal-content {
    position: relative;
    display: flex;
    flex-direction: column;
    width: 100%;
    pointer-events: auto;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 0.3rem;
    outline: 0;
}

.modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1040;
    width: 100vw;
    height: 100vh;
    background-color: #000;
}

.modal-backdrop.fade {
    opacity: 0;
}

.modal-backdrop.show {
    opacity: 0.5;
}

/* Bottom Modal Styles */
.modal.bottom-modal {
    padding: 0 !important;
    z-index: 1060 !important; /* Higher than default modal */
}

.modal.bottom-modal .modal-dialog {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    margin: 0;
    width: 100%;
    max-width: 100%;
    transform: translate(0, 100%);
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 1070 !important;
}

.modal.bottom-modal.show .modal-dialog {
    transform: translate(0, 0);
}

.modal.bottom-modal .modal-content {
    border-radius: 20px 20px 0 0;
    border: none;
    box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.15);
    max-height: 90vh;
    overflow-y: auto;
    z-index: 1080 !important;
}

/* Add a handle for better UX */
.modal.bottom-modal .modal-header::before {
    content: '';
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 5px;
    background-color: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
}

.modal.bottom-modal .modal-header {
    position: relative;
    padding-top: 25px; /* Space for the handle */
}

/* Preview Modal Styles */
.preview-modal {
    border-radius: 20px 20px 0 0;
    overflow: hidden;
    box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.2);
}

.preview-header {
    background: var(--primary-yellow);
    color: var(--text-dark);
    padding: 1.5rem;
    border: none;
    position: sticky;
    top: 0;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.preview-header .modal-title {
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    color: var(--text-dark);
    margin-bottom: 0;
}

.preview-header .modal-title i {
    margin-right: 10px;
    font-size: 1.4rem;
}

.preview-body {
    padding: 0;
    background: #f8f9fa;
}

.preview-container {
    display: flex;
    flex-direction: column;
    max-width: 100%;
}

.preview-image-section {
    width: 100%;
    height: 250px;
    overflow: hidden;
    position: relative;
}

.preview-image-container {
    width: 100%;
    height: 100%;
    position: relative;
}

.preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.no-image-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #e9ecef;
    color: #6c757d;
}

.no-image-placeholder i {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.preview-details-section {
    padding: 1.5rem;
    background: white;
    border-radius: 20px 20px 0 0;
    margin-top: -20px;
    position: relative;
    box-shadow: 0 -10px 20px rgba(0, 0, 0, 0.05);
}

.preview-header-info {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1.5rem;
}

.preview-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--text-dark);
    margin: 0;
    line-height: 1.2;
}

.preview-category-badge {
    background: var(--primary-yellow);
    color: var(--text-dark);
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    box-shadow: 0 3px 10px rgba(var(--primary-yellow-rgb), 0.3);
}

.preview-price-section {
    margin-bottom: 1.5rem;
}

.preview-price {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-yellow);
    display: inline-block;
    padding: 5px 15px;
    background: rgba(var(--primary-yellow-rgb), 0.1);
    border-radius: 10px;
}

.preview-description-box {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 10px;
    margin-bottom: 1.5rem;
    border-left: 4px solid var(--primary-yellow);
}

.preview-description {
    margin: 0;
    color: var(--text-dark);
    line-height: 1.6;
}

.preview-info-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.info-item {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.info-item i {
    background: var(--primary-yellow);
    color: var(--text-dark);
    width: 40px;
    height: 40px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    box-shadow: 0 3px 10px rgba(var(--primary-yellow-rgb), 0.3);
}

.info-content {
    display: flex;
    flex-direction: column;
}

.info-content label {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-bottom: 2px;
}

.info-content span {
    font-weight: 600;
    color: var(--text-dark);
}

.preview-details-box {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 1.5rem;
}

.details-section {
    margin-bottom: 1.5rem;
}

.details-section:last-child {
    margin-bottom: 0;
}

.details-section h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
}

.details-section p {
    margin: 0;
    color: var(--text-dark);
}

.preview-footer {
    background: white;
    border-top: 1px solid rgba(0,0,0,0.1);
    padding: 1rem;
    display: flex;
    justify-content: flex-end;
}

.preview-footer .btn {
    padding: 10px 20px;
    font-weight: 600;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Enhanced Delete Modal Styles */
.enhanced-delete-modal {
    border-radius: 20px 20px 0 0;
    overflow: hidden;
    box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.2);
}

.enhanced-delete-header {
    background: var(--danger-red);
    color: white;
    padding: 1.5rem;
    border: none;
    position: sticky;
    top: 0;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.enhanced-delete-title {
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    color: white;
    margin-bottom: 0;
}

.danger-icon-wrapper {
    background: rgba(255, 255, 255, 0.2);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.btn-close-white {
    filter: brightness(0) invert(1);
}

.enhanced-delete-body {
    padding: 2rem;
    background: white;
}

.delete-confirmation-content {
    text-align: center;
}

.delete-item-info {
    background: rgba(220, 53, 69, 0.1);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.item-preview {
    display: flex;
    align-items: center;
    gap: 1rem;
    justify-content: center;
}

.item-icon {
    background: #dc3545;
    color: white;
    width: 48px;
    height: 48px;
    border-radius: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    box-shadow: 0 3px 10px rgba(220, 53, 69, 0.4);
}

.item-details {
    text-align: left;
}

.item-name {
    margin: 0;
    font-weight: 600;
    color: #dc3545;
    font-size: 1.2rem;
}

.item-category {
    margin: 0;
    font-size: 0.9rem;
}

.delete-question {
    font-size: 1.2rem;
    font-weight: 500;
    margin: 1.5rem 0;
    color: var(--text-dark);
}

.enhanced-warning {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    text-align: left;
    margin-bottom: 0;
    background-color: #f8d7da;
    border-color: #f5c6cb;
    border-radius: 10px;
    padding: 1rem;
}

.warning-icon {
    color: #dc3545;
    font-size: 1.5rem;
    flex-shrink: 0;
}

.warning-content {
    color: #721c24;
}

.warning-content strong {
    font-weight: 700;
}

.enhanced-delete-footer {
    background: #f8f9fa;
    border-top: 1px solid #dee2e6;
    padding: 1rem;
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
}

.enhanced-delete-footer .btn {
    padding: 10px 20px;
    font-weight: 600;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.enhanced-delete-footer .enhanced-delete-btn {
    background: #dc3545;
    border-color: #dc3545;
    color: white;
    box-shadow: 0 3px 10px rgba(220, 53, 69, 0.4);
}

.enhanced-delete-footer .enhanced-delete-btn:hover {
    background: #c82333;
    border-color: #bd2130;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(220, 53, 69, 0.5);
}

/* Custom Modal Animation Enhancements */
.custom-modal .modal-content {
    animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

.custom-modal.closing .modal-content {
    animation: slideDown 0.3s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards;
}

@keyframes slideUp {
    from {
        transform: translateY(100%);
        opacity: 0.8;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes slideDown {
    from {
        transform: translateY(0);
        opacity: 1;
    }
    to {
        transform: translateY(100%);
        opacity: 0;
    }
}

/* Modal Handle */
.modal-handle {
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 5px;
    background-color: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .preview-header-info {
        flex-direction: column;
    }
    
    .preview-category-badge {
        align-self: flex-start;
        margin-top: 0.5rem;
    }
    
    .preview-info-grid {
        grid-template-columns: 1fr;
    }
    
    .enhanced-delete-footer {
        flex-direction: column;
    }
    
    .enhanced-delete-footer .btn {
        width: 100%;
        justify-content: center;
    }
}

/* Warning Animation */
@keyframes warningPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.warning-icon.warning-pulse {
    animation: warningPulse 0.6s ease-in-out infinite;
    color: #dc3545;
}

/* Enhanced Modal Interactions */
.custom-modal .modal-content {
    touch-action: pan-y;
    -webkit-overflow-scrolling: touch;
}

.custom-modal .btn {
    position: relative;
    z-index: 10;
    transform: translateZ(0);
}

.custom-modal .btn:active {
    transform: translateZ(0) scale(0.98);
}

/* Ensure all buttons are clickable */
.custom-modal button,
.custom-modal a,
.custom-modal input[type="submit"],
.custom-modal input[type="button"] {
    cursor: pointer !important;
    pointer-events: auto !important;
    position: relative !important;
    z-index: 10 !important;
    transform: translateZ(0);
}

/* Improve form button in delete modal */
.enhanced-delete-footer form {
    flex: 1;
}

@media (min-width: 576px) {
    .enhanced-delete-footer form {
        flex: 0 1 auto;
    }
}

/* Critical Z-index Fix */
.modal {
    z-index: 1050 !important;
}

.modal-backdrop {
    z-index: 1040 !important;
}

.modal-dialog {
    z-index: 1060 !important;
    max-width: 90% !important;
    margin: 0.5rem auto !important;
}

.modal-content {
    z-index: 1070 !important;
    max-height: 80vh !important;
    overflow-y: auto !important;
}

/* Size adjustments */
@media (min-width: 768px) {
    .modal-dialog {
        max-width: 600px !important;
    }
    
    .modal-dialog.modal-lg {
        max-width: 800px !important;
    }
}

/* Force pointer events */
.modal-content * {
    pointer-events: auto !important;
}

/* Ensure buttons are clickable */
.modal button,
.modal .btn,
.modal a,
.modal input[type="submit"] {
    position: relative !important;
    z-index: 1080 !important;
    pointer-events: auto !important;
}

/* Fix modal body size */
.preview-body {
    max-height: 60vh !important;
    overflow-y: auto !important;
}

/* Make preview container more compact */
.preview-container {
    display: flex;
    flex-direction: column;
}

.preview-image-section {
    height: 200px !important;
}

.preview-details-section {
    padding: 1rem !important;
}

.preview-info-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem !important;
}

.info-item {
    padding: 0.5rem !important;
}

.preview-description-box {
    padding: 0.75rem !important;
    margin-bottom: 0.75rem !important;
}

.preview-details-box {
    padding: 0.75rem !important;
}

.details-section {
    margin-bottom: 0.75rem !important;
}

/* Make delete modal more compact */
.enhanced-delete-body {
    padding: 1rem !important;
}

.delete-item-info {
    padding: 1rem !important;
    margin-bottom: 1rem !important;
}

.delete-question {
    margin: 1rem 0 !important;
}

/* Extreme z-index override */
#previewModal, #deleteModal, #addCategoryModal {
    z-index: 9999 !important;
}

.modal-backdrop.show {
    z-index: 9990 !important;
    pointer-events: none !important;
}

#previewModal .modal-dialog,
#deleteModal .modal-dialog,
#addCategoryModal .modal-dialog {
    z-index: 10000 !important;
    pointer-events: auto !important;
}

#previewModal .modal-content,
#deleteModal .modal-content,
#addCategoryModal .modal-content {
    z-index: 10001 !important;
    pointer-events: auto !important;
}

/* Fix for backdrop appearing before modal */
.modal {
    animation: modalFadeIn 0.1s forwards;
}

.modal-backdrop {
    animation: backdropFadeIn 0.2s forwards;
}

@keyframes modalFadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

@keyframes backdropFadeIn {
    0% { opacity: 0; }
    100% { opacity: 0.5; }
}

/* Ensure modal appears before backdrop */
.modal-dialog {
    animation: slideUpFast 0.2s ease-out forwards;
}

@keyframes slideUpFast {
    from {
        transform: translateY(50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Enhanced Edit Menu Item JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // First, remove any existing backdrops
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
        backdrop.remove();
    });
    
    // Initialize modals
    const previewModal = new bootstrap.Modal(document.getElementById('previewModal'), {
        backdrop: 'static'
    });
    
    const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'), {
        backdrop: 'static'
    });
    
    const addCategoryModal = new bootstrap.Modal(document.getElementById('addCategoryModal'), {
        backdrop: 'static'
    });
    
    // Store modals in window object for global access
    window.modals = {
        previewModal,
        deleteModal,
        addCategoryModal
    };
    
    // Set up event listeners for buttons
    document.getElementById('previewBtn').addEventListener('click', function(e) {
        e.preventDefault();
        showPreview();
    });
    
    document.getElementById('deleteBtn').addEventListener('click', function(e) {
        e.preventDefault();
        showDelete();
    });
    
    document.getElementById('addCategoryBtn').addEventListener('click', function(e) {
        e.preventDefault();
        showAddCategory();
    });
    
    // Fix all close buttons
    document.querySelectorAll('[data-bs-dismiss="modal"]').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const modalId = this.closest('.modal').id;
            closeModal(modalId);
        });
    });
    
    // Fix all buttons in modals to ensure they're clickable
    document.querySelectorAll('.modal button, .modal .btn').forEach(button => {
        button.style.position = 'relative';
        button.style.zIndex = '10002';
        button.style.pointerEvents = 'auto';
    });
    
    // Initialize progress bar
    updateProgress();
    
    // Set up event listeners for form fields
    const formFields = document.querySelectorAll('#editMenuItemForm input, #editMenuItemForm select, #editMenuItemForm textarea');
    formFields.forEach(field => {
        field.addEventListener('change', updateProgress);
        field.addEventListener('input', updateProgress);
    });
    
    // Description counter
    const description = document.getElementById('description');
    const descriptionCount = document.getElementById('descriptionCount');
    if (description && descriptionCount) {
        description.addEventListener('input', () => {
            descriptionCount.textContent = description.value.length;
        });
    }
    
    // Ingredients counter
    const ingredients = document.getElementById('ingredients');
    const ingredientsCount = document.getElementById('ingredientsCount');
    if (ingredients && ingredientsCount) {
        ingredients.addEventListener('input', () => {
            ingredientsCount.textContent = ingredients.value.length;
        });
    }
    
    // Unlimited stock checkbox
    const unlimitedStock = document.getElementById('unlimitedStock');
    const stock = document.getElementById('stock');
    if (unlimitedStock && stock) {
        unlimitedStock.addEventListener('change', () => {
            stock.disabled = unlimitedStock.checked;
            if (unlimitedStock.checked) {
                stock.value = '0';
            }
            updateProgress();
        });
    }
    
    // Image upload
    initializeImageUpload();
});

// Initialize image upload
function initializeImageUpload() {
    const imageInput = document.getElementById('image');
    const uploadPlaceholder = document.getElementById('uploadPlaceholder');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const currentImageDisplay = document.getElementById('currentImageDisplay');
    
    // Image upload click
    if (uploadPlaceholder) {
        uploadPlaceholder.addEventListener('click', () => {
            imageInput.click();
        });
    }
    
    // Image input change
    if (imageInput) {
        imageInput.addEventListener('change', handleImageChange);
    }
    
    // Change current image
    const changeCurrentImage = document.getElementById('changeCurrentImage');
    if (changeCurrentImage) {
        changeCurrentImage.addEventListener('click', () => {
            imageInput.click();
        });
    }
    
    // Remove current image
    const removeCurrentImage = document.getElementById('removeCurrentImage');
    if (removeCurrentImage) {
        removeCurrentImage.addEventListener('click', () => {
            // Implementation would go here
            console.log('Current image removed');
            updateProgress();
        });
    }
    
    // Change preview image
    const changeImage = document.getElementById('changeImage');
    if (changeImage) {
        changeImage.addEventListener('click', () => {
            imageInput.click();
        });
    }
    
    // Remove preview image
    const removeImage = document.getElementById('removeImage');
    if (removeImage) {
        removeImage.addEventListener('click', () => {
            // Implementation would go here
            console.log('New image removed');
            updateProgress();
        });
    }
}

// Handle image change
function handleImageChange(e) {
    // Implementation would go here
    console.log('Image changed');
    updateProgress();
}

// Update progress bar
function updateProgress() {
    const progressBar = document.getElementById('completionProgress');
    const progressText = document.querySelector('.progress-text');
    const completionText = document.getElementById('completionText');
    const formFields = document.querySelectorAll('#editMenuItemForm input, #editMenuItemForm select, #editMenuItemForm textarea');
    
    // Field weights for progress calculation
    const fieldWeights = {
        'name': 15,
        'category_id': 15,
        'price': 15,
        'description': 10,
        'ingredients': 10,
        'image': 10,
        'stock': 5,
        'preparation_time': 5,
        'allergens': 5,
        'calories': 5,
        'status': 5
    };
    
    let totalWeight = 0;
    let completedWeight = 0;
    
    // Calculate total weight of all fields
    for (const field in fieldWeights) {
        totalWeight += fieldWeights[field];
    }
    
    // Calculate completed weight
    formFields.forEach(field => {
        if (field.name in fieldWeights) {
            // Check if field has a value
            if (field.value && field.value.trim() !== '') {
                completedWeight += fieldWeights[field.name];
            }
            // Special case for image (already uploaded)
            if (field.name === 'image' && document.getElementById('currentImageDisplay')) {
                completedWeight += fieldWeights[field.name];
            }
        }
    });
    
    // Calculate percentage
    let percentage = Math.round((completedWeight / totalWeight) * 100);
    
    // Ensure minimum of 5% for visual feedback
    percentage = Math.max(5, percentage);
    
    // Update progress bar
    if (progressBar) {
        progressBar.style.width = percentage + '%';
        progressBar.setAttribute('aria-valuenow', percentage);
    }
    
    if (progressText) {
        progressText.textContent = percentage + '%';
    }
    
    // Update completion text and status indicator
    if (completionText) {
        const statusIndicator = document.querySelector('.completion-status .status-indicator');
        
        // Remove all status classes first
        statusIndicator.classList.remove('ready', 'almost-ready', 'in-progress', 'needs-work');
        
        if (percentage >= 100) {
            completionText.textContent = 'Ready to update!';
            statusIndicator.classList.add('ready');
        } else if (percentage >= 80) {
            completionText.textContent = 'Almost ready!';
            statusIndicator.classList.add('almost-ready');
        } else if (percentage >= 50) {
            completionText.textContent = 'Making good progress!';
            statusIndicator.classList.add('in-progress');
        } else {
            completionText.textContent = 'Please complete more fields';
            statusIndicator.classList.add('needs-work');
        }
    }
}

// Show preview modal
function showPreview() {
    // Get form values
    const name = document.getElementById('name').value || 'Untitled Item';
    const category = document.getElementById('category_id').selectedOptions[0]?.text || 'No Category';
    const description = document.getElementById('description').value || 'No description provided';
    const price = document.getElementById('price').value || '0.00';
    const stock = document.getElementById('stock').value || '0';
    const prepTime = document.getElementById('preparation_time').value || 'Not specified';
    const calories = document.getElementById('calories').value || 'Not specified';
    const ingredients = document.getElementById('ingredients').value || 'Not specified';
    const allergens = document.getElementById('allergens').value || 'None specified';

    // Update preview modal content
    document.getElementById('previewName').textContent = name;
    document.getElementById('previewCategory').textContent = category;
    document.getElementById('previewDescription').textContent = description;
    document.getElementById('previewPrice').textContent = `EGP ${price}`;
    document.getElementById('previewStock').textContent = stock === '0' ? 'Unlimited' : stock;
    document.getElementById('previewPrepTime').textContent = prepTime === 'Not specified' ? prepTime : `${prepTime} minutes`;
    document.getElementById('previewCalories').textContent = calories === 'Not specified' ? calories : `${calories} kcal`;
    document.getElementById('previewIngredients').textContent = ingredients;
    document.getElementById('previewAllergens').textContent = allergens;

    // Handle image preview
    const imageInput = document.getElementById('image');
    const previewContainer = document.querySelector('.preview-image-container');
    
    // Clear previous content
    previewContainer.innerHTML = '';
    
    if (imageInput.files && imageInput.files[0]) {
        // New image selected
        const reader = new FileReader();
        reader.onload = function(e) {
            previewContainer.innerHTML = `<img src="${e.target.result}" alt="Menu Item" class="preview-image">`;
        }
        reader.readAsDataURL(imageInput.files[0]);
    } else if (document.getElementById('currentImageDisplay')) {
        // Existing image
        const currentImage = document.getElementById('currentImageDisplay').querySelector('img');
        if (currentImage) {
            previewContainer.innerHTML = `<img src="${currentImage.src}" alt="Menu Item" class="preview-image">`;
        } else {
            showNoImagePlaceholder(previewContainer);
        }
    } else {
        // No image
        showNoImagePlaceholder(previewContainer);
    }

    // Create a proper backdrop
    const backdrop = handleBackdrop();
    
    // First, make the modal visible but with opacity 0
    const modalElement = document.getElementById('previewModal');
    modalElement.style.display = 'block';
    modalElement.style.opacity = '0';
    
    // Fix z-index before showing modal
    fixModalZIndex('previewModal');
    
    // Force the modal dialog to be visible first
    const modalDialog = modalElement.querySelector('.modal-dialog');
    if (modalDialog) {
        modalDialog.style.display = 'block';
        modalDialog.style.opacity = '1';
        modalDialog.style.zIndex = '10000';
    }
    
    // Short delay to ensure the modal is in the DOM
    setTimeout(() => {
        // Now show the modal with animation
        modalElement.style.opacity = '1';
        window.modals.previewModal.show();
        
        // Additional fixes after modal is shown
        setTimeout(() => {
            ensureModalIsVisible('previewModal');
        }, 50);
    }, 10);
}

// Fix modal z-index
function fixModalZIndex(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    
    // Set extreme z-index values
    modal.style.zIndex = '9999';
    
    const modalDialog = modal.querySelector('.modal-dialog');
    if (modalDialog) {
        modalDialog.style.zIndex = '10000';
    }
    
    const modalContent = modal.querySelector('.modal-content');
    if (modalContent) {
        modalContent.style.zIndex = '10001';
    }
    
    // Make sure backdrop doesn't block interaction
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
        backdrop.style.zIndex = '9990';
        backdrop.style.pointerEvents = 'none';
    });
    
    // Ensure all buttons are clickable
    modal.querySelectorAll('button, .btn, a, input[type="submit"]').forEach(button => {
        button.style.position = 'relative';
        button.style.zIndex = '10002';
        button.style.pointerEvents = 'auto';
    });
}

// Show no image placeholder
function showNoImagePlaceholder(container) {
    container.innerHTML = `
        <div class="no-image-placeholder">
            <i class="fas fa-image"></i>
            <p>No Image Available</p>
        </div>
    `;
}

// Ensure modal is visible
function ensureModalIsVisible(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    
    // Force display
    modal.style.display = 'block';
    
    // Make sure modal is on top
    modal.style.zIndex = '9999';
    
    // Make sure backdrop is behind
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
        backdrop.style.zIndex = '9990';
    });
    
    // Make sure dialog is visible
    const modalDialog = modal.querySelector('.modal-dialog');
    if (modalDialog) {
        modalDialog.style.zIndex = '10000';
        modalDialog.style.pointerEvents = 'auto';
    }
    
    // Make sure content is visible
    const modalContent = modal.querySelector('.modal-content');
    if (modalContent) {
        modalContent.style.zIndex = '10001';
        modalContent.style.pointerEvents = 'auto';
    }
}

// Show delete modal
function showDelete() {
    // Get current item name and category for confirmation
    const name = document.getElementById('name').value || 'this menu item';
    const category = document.getElementById('category_id').selectedOptions[0]?.text || 'No Category';
    
    // Update delete confirmation text if needed
    const itemName = document.querySelector('#deleteModal .item-name');
    const itemCategory = document.querySelector('#deleteModal .item-category');
    const deleteQuestion = document.querySelector('#deleteModal .delete-question');
    
    if (itemName) itemName.textContent = name;
    if (itemCategory) itemCategory.textContent = category;
    if (deleteQuestion) deleteQuestion.textContent = `Are you sure you want to delete "${name}"?`;
    
    // Add warning animation
    const warningIcon = document.querySelector('#deleteModal .warning-icon');
    if (warningIcon) {
        warningIcon.classList.add('warning-pulse');
    }
    
    // Create a proper backdrop
    const backdrop = handleBackdrop();
    
    // First, make the modal visible but with opacity 0
    const modalElement = document.getElementById('deleteModal');
    modalElement.style.display = 'block';
    modalElement.style.opacity = '0';
    
    // Fix z-index before showing modal
    fixModalZIndex('deleteModal');
    
    // Force the modal dialog to be visible first
    const modalDialog = modalElement.querySelector('.modal-dialog');
    if (modalDialog) {
        modalDialog.style.display = 'block';
        modalDialog.style.opacity = '1';
        modalDialog.style.zIndex = '10000';
    }
    
    // Short delay to ensure the modal is in the DOM
    setTimeout(() => {
        // Now show the modal with animation
        modalElement.style.opacity = '1';
        window.modals.deleteModal.show();
        
        // Additional fixes after modal is shown
        setTimeout(() => {
            ensureModalIsVisible('deleteModal');
        }, 50);
    }, 10);
}

// Show add category modal
function showAddCategory() {
    // Reset form
    document.getElementById('addCategoryForm').reset();
    
    // Create a proper backdrop
    const backdrop = handleBackdrop();
    
    // First, make the modal visible but with opacity 0
    const modalElement = document.getElementById('addCategoryModal');
    modalElement.style.display = 'block';
    modalElement.style.opacity = '0';
    
    // Fix z-index before showing modal
    fixModalZIndex('addCategoryModal');
    
    // Force the modal dialog to be visible first
    const modalDialog = modalElement.querySelector('.modal-dialog');
    if (modalDialog) {
        modalDialog.style.display = 'block';
        modalDialog.style.opacity = '1';
        modalDialog.style.zIndex = '10000';
    }
    
    // Short delay to ensure the modal is in the DOM
    setTimeout(() => {
        // Now show the modal with animation
        modalElement.style.opacity = '1';
        window.modals.addCategoryModal.show();
        
        // Additional fixes after modal is shown
        setTimeout(() => {
            ensureModalIsVisible('addCategoryModal');
        }, 50);
    }, 10);
}

// Close modal function
function closeModal(modalId) {
    // Fix backdrop issue first
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
        backdrop.style.zIndex = '9990';
        backdrop.style.pointerEvents = 'none';
    });
    
    if (window.modals && window.modals[modalId + 'Modal']) {
        window.modals[modalId + 'Modal'].hide();
        
        // Force remove backdrop after hiding
        setTimeout(() => {
            document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
                backdrop.remove();
            });
        }, 300);
    } else {
        // Fallback
        const modalElement = document.getElementById(modalId);
        const modalInstance = bootstrap.Modal.getInstance(modalElement);
        if (modalInstance) {
            modalInstance.hide();
            
            // Force remove backdrop after hiding
            setTimeout(() => {
                document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
                    backdrop.remove();
                });
            }, 300);
        }
    }
    
    // Remove warning animation if it's the delete modal
    if (modalId === 'deleteModal') {
        const warningIcon = document.querySelector('#deleteModal .warning-icon');
        if (warningIcon) {
            warningIcon.classList.remove('warning-pulse');
        }
    }
}

// Save category function
function saveCategory() {
    const categoryName = document.getElementById('newCategoryName').value;
    const categoryDescription = document.getElementById('newCategoryDescription').value;
    
    if (!categoryName) {
        alert('Please enter a category name');
        return;
    }
    
    // Here you would typically make an AJAX call to save the category
    console.log('Saving category:', categoryName, categoryDescription);
    
    // For now, just close the modal
    closeModal('addCategoryModal');
}

// Handle backdrop properly
function handleBackdrop() {
    // Remove any existing backdrops
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
        backdrop.remove();
    });
    
    // Create a new backdrop with correct z-index
    const backdrop = document.createElement('div');
    backdrop.className = 'modal-backdrop fade show';
    backdrop.style.zIndex = '9990';
    backdrop.style.opacity = '0';
    backdrop.style.pointerEvents = 'none';
    document.body.appendChild(backdrop);
    
    // Fade in backdrop after a delay
    setTimeout(() => {
        backdrop.style.opacity = '0.5';
    }, 50);
    
    return backdrop;
}
</script>
{% endblock %}
